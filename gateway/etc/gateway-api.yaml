Name: gateway-api
Host: 0.0.0.0
Port: 28256
GatewayMode: ${MODE}
Cors:
  - "${VITE_HOST}"

ApiPrefix:
  - /api
  - /dev-api

ApiCanonicalPrefix: /api 

Log:
  Encoding: json
  Level: info

AuthRpc:
  Endpoint: localhost:7777
  Target: consul://${CONSUL_HOST}/auth.rpc?wait=14s
  KeepAlive: true
  NonBlock: true # nonblock是go-zero的特性，用于非阻塞地调用远程服务

UserRpc:
  Endpoint: localhost:7779
  Target: consul://${CONSUL_HOST}/user.rpc?wait=14s
  KeepAlive: true
  NonBlock: true 

Upstreams:
  - Name: 'next-ai'
    Service: 'next-ai'
    PathPrefix: '/nextapi/'
    StripPrefix: ''
    TimeoutMS: 5000
    PassHeaders:
      - "Authorization"
      - "X-Request-Id"
  - Name: 'next-chiikawapro'
    Service: 'next-chiikawapro'
    PathPrefix: '/api/'
    StripPrefix: ''
    TimeoutMS: 5000
    PassHeaders:
      - "Authorization"
      - "X-Request-Id"

Consul:
  Address: ${CONSUL_HOST}
  Scheme: http
  WaitTime: 30s

Auth:
  Strict: true # 严格模式，用于确保调用远程服务时，服务端返回的错误信息是完整的
  TokenLookup: "header: Authorization" # 用于从请求头中获取token
  AccessSecret: ${JWT_SECRET}
  AccessExpire: 3600
  Issuer: "auth.rpc"
  LeewaySeconds: 2
  IgnoreRoutes: # 忽略的请求路径
    - /api/v1/ping
    - /api/v1/login
    - /api/v1/refresh
    - /api/v1/logout
    - /api/v1/logout-all
    - /internal/upstreams
    - /nextapi # Ignore all nuxtapi routes for upstream forwarding 
    - /api/ # Ignore all api routes for upstream forwarding 
# JwtAuth:
#   AccessSecret: ${JWT_SECRET}
#   Issuer: "auth.rpc"
#   LeewaySeconds: 2
  

RateLimit:
  Enable: true
  WindowSeconds: 60
  MaxAttempts: 10
  By: "ip+username"
  RateLimitRedis:
    Host: ${REDIS_HOST}
    Pass: "${REDIS_PASSWORD}"
    Type: node
    Key: ratelimit
    Tls: false
    NonBlock: true